2008-03-31  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Refactored a GetLastAvailablePacketIndex out of
	  GetLastAvailablePts. In ReadPacket use the source provided in the
	  ASFPacket.

2008-03-31  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: ReadData: Check if stream is seekable before seeking.

2008-03-28  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Define __STDC_LIMIT_MACROS.

2008-03-28  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf-structures.cpp: Use IMediaSource:::ReadAll instead of
	  IMediaSource::Read.
	* asf.h: Simplify the logging defines a bit.

2008-03-27  Fernando Herrera  <fherrera@novell.com>

	* asf.cpp: Fix log functions tu use GetPositon.

2008-03-26  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-test.cpp, asf-generated.h: Updated.
	* asf-structures.h, asf-structures.cpp: All FillInAll takes a context
	  argument instead of a only a parser argument.
	* asf.h, asf.cpp: Remove ASFSource and descendants, just use IMediaSource.
	  Add an ASFReader, a smarter reader for more than one stream which skips
	  unwanted streams and does a lot less seeking that the previous
	  one-per-stream readers. It can also determine the last pts available
	  without blocking and seeking.

2008-03-19  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Rename SeekWithPts to SeekToPts to make naming consistent.

2008-03-19  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: ASFFrameReader: If the source can seek to a pts, request
	  the source to do so. In this case we assume that the source knows where
	  a packet begins, and that we're always positioned at the correct packet
	  (i.e. we won't do a normal seek to find a packet).

2008-03-19  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h, asf.cpp, asf.h, asf-test.cpp, asf-structures.cpp: Return
	  MediaResult from ReadPacket and the FillInAll methods. In ReadPacket we
	  also need to seek to the next packet if some error occured. This allows
	  us to detect invalid packets and skip them in ASFFrameReader::ReadMore.
	* Makefile: Updated.

2008-03-12  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Use ErrorEventArgs for error reporting so that the errors
	  can easily be bubbled up the pipeline.
	* asf.cs, asf-generated.cpp, asf-guids.cpp, asf-structures.cpp: Remove
	  newlines in error messages.
	* asf-generated.h: Updated.
	* asf-test.cpp: More debug spew.

2008-03-12  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.h: Spaces to tabs.

2008-03-12  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.cpp: Remove newlines from error messages.

2008-03-11  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Rename GetPositionOfPts to EstimatePtsPosition and remove
	  the estimate parameter, it's never used.

2008-03-11  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Always print out asf errors.
	* asf-structures.cpp: Remove newline from error message.

2008-03-11  Fernando Herrera  <fherrera@novell.com>

	* asf.cpp:
	* asf.h: Added ASFBufferSource class to easily use the parser with the
	header downloaded from mms://

2008-03-07  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Implemented SeekToStart.

2008-03-07  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h: Fix crash, we need to allocate the size of the memory,
	  not the length of the array.

2008-02-29  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Fix MIN/MAX confusion.

2008-02-29  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Check if there are stream properties in any extended
	  stream properties object, and put them in our streams list. Fixed a few
	  warnings, sprinkled some 'const' modifiers here and there.
	* asf-generated.h, Makefile, asf-generated.cpp: Updated.
	* asf-structures.cpp: Fixed warnings, added debug output.
	* asf-structures.h: Implemented getters for the variable sized data on
	  asf_extended_stream_properties. Sprinkled some const modifiers.
	* asf-test.cpp: Some API updates.
	* asf.cs: Handle comments.

2008-02-06  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Free the index upon destruction.

2008-02-06  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Fix MIN/MAX confusion.

2008-02-04  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Don't create an index if we have a media with 0 packets.

2008-02-04  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Fix more signedness problems.

2008-02-04  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Make packet index a uint64. When adding an index entry,
	  cap the packet index to the size of the index (fixes a crash).

2008-02-01  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Initialize key_frames_only.

2008-01-31  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: ASFFrameReader: (Advance) Return the last payload when reaching
	  the end of the stream. (Seek) save the packet index of the key frame as
	  it was before Advance was called, not after.

2008-01-31  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: ASFFrameReader: Implement an index and use it when
	  seeking. Implement GetPositionOfPts to estimate the file position of a
	  pts. AdvanceFrame: Normalize all pts to start at 0, skip partial
	  payloads (might happen when seeking)
	* asf-structures.h: Added comments to fields representing some sort of time
	  or duration stating the units.

2008-01-28  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Add a null check.

2008-01-28  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Create a frame reader per stream. Simplifies a bit the
	  reader, as well as it allows us to ignore unwanted streams correctly.
	  Create a better seek implementation, and started work on an index.

2008-01-24  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.h: Fix comment to follow coding style. Fix ASFSource::Read signature.

2008-01-24  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-ffmpeg.cpp, asf-ffmpeg.h: Removed, no longer needed.
	* asf-generated.h, asf.cpp: Updated.
	* asf-structures.cpp, asf-test.cpp, asf-debug.h: Use int*_t consistently.

2008-01-23  Jeffrey Stedfast  <fejj@novell.com>

	* asf-test.cpp (test_file): use a FileSource so that we can get
	rid of ASFFileSource.

	* asf.cpp|h: Get rid of ASFFileSource.

2008-01-23  Jeffrey Stedfast  <fejj@novell.com>

	* asf-structures.cpp|h: Fixed lots of integer-type
	usage (e.g. don't use a size_t when it should be an int64_t, etc).

	* asf-ffmpeg.cpp|h: Same.

	* asf.cpp|h: Here too.

2008-01-14  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h, asf-ffmpeg.h, asf-structures.cpp: Fix warnings.

2008-01-14  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Add ASFParser::GetPacketCount, and when in ASFFrameReader
	  when reading packets set eof to true if read all packets.

2008-01-11  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-ffmpeg.h: Fix warning.
	* asf.cpp: If stream number is 0, don't try to handle it as a script
	  command.

2008-01-10  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: ASFParser::ReadPacket: don't seek if we don't have to.
	  Implement support for selecting which stream to get the frame for in
	  ASFFrameReader::Advance. Added a ASFMediaSource to glue the ASFSource
	  and a IMediaSource together.
	* asf-ffmpeg.cpp, asf-ffmpeg.h: Only compile if INCLUDE_FFMPEG is defined.
	* asf-generated.cpp, asf-generated.h, asf-structures.h, asf-structures.cpp:
	  Implemented reading of extended header objects.
	* asf-guids.h: Export the functions defined here.

2007-12-31  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h: Add some const modifiers to make intentions of a few
	  functions clearer.

2007-12-31  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-ffmpeg.cpp: Use our own demuxer by default.

2007-12-21  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h: Remove commented out code.

2007-12-19  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Implement support for markers as a separate stream.
	* asf-ffmpeg.cpp: Make the frame reader check if there are any script
	  command streams.

2007-12-19  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-ffmpeg.cpp: Don't pass any packets to ffmpeg from streams which hasn't
	  been registered with ffmpeg.

2007-12-19  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.cpp: Fix memory leaks with debug code, and fix memory
	  corruption when reading compressed payloads.
	* asf-test.cpp: Return false if the parser has any errors.
	* asf.cpp, asf.h: ASFParser: use a custom list for the errors. Don't report
	  any errors in GetPacketOffset, packet_index will be out of range when
	  the end of a file is reached.

2007-12-18  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp: Fix frame reading, previously we would skip everything in the
	  queue of payloads except the first and second payload.

2007-12-17  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.cpp: Don't subtract the size of the arrays from the total
	  size left.

2007-11-27  Jeffrey Stedfast  <fejj@novell.com>

	* asf-ffmpeg.cpp (ffmpeg_asf_read_header): Fixed a compile error.
	(AVStream_dump): codec_info_nb_frames is no longer available in
	current ffmpeg svn (ugh).

2007-11-02  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h, asf.cpp, asf-structures.cpp: Implement reading of
	  compressed payloads. Untested since I haven't found any asf files with
	  compressed payloads yet.
	* asf-ffmpeg.cpp: Comment out some code.

2007-11-02  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Add a comment.
	* asf-ffmpeg.cpp, asf-ffmpeg.h: Set a couple of ffmpeg stream and packet
	  fields correctly. Update debug code, remove dead code.
	* asf-test.cpp: Only show object tracking summary if we're actually doing
	  object tracking.

2007-11-01  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h, asf-ffmpeg.h: Code cleanup, mostly moved implementation to
	  the cpp file, some refactoring.

2007-10-31  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.cs, asf.h, asf-generated.cpp, asf-generated.h,
	  asf-structures.cpp, asf-structures.h: Redo ASFParser::Malloc to avoid
	  warnings, and make sure the return value is always checked.

2007-10-30  Jeffrey Stedfast  <fejj@novell.com>

	* asf-structures.cpp (FillInAll): max_packet_size is part of
	file_properties, not header.

	* asf-structures.h: g++ doesn't like it when you jump over
	locations where variables are declared (especially when the
	variables are used at the jump destination). Fixed by declaring
	the variables at the top of the method.

2007-10-30  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h, asf.cpp, asf.h, asf-structures.cpp: Add consistency
	  checks before all memory allocations (or comments explaining why it
	  wouldn't be necessary).

2007-10-30  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.cpp, asf.h: Only seek to keyframes. Implemented support for multiple
	  errors. Removed some dead code. Fix an off-by-one zero-fill.

2007-10-30  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-ffmpeg.cpp: Make sure it builds with older versions of ffmpeg.

2007-10-29  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-ffmpeg.cpp: Use ffmpeg's memory allocator when copying bytes into
	  buffers freed by ffmpeg. Fix a couple of warnings.

2007-10-26  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h, asf-debug.h, asf-generated.cpp, asf.mdp, asf.cpp,
	  asf-generated.h, asf-ffmpeg.cpp, asf.h, asf-ffmpeg.h, asf-test.cpp,
	  debug.cpp, asf-structures.cpp, debug.h, asf-test.h, asf.cs, Makefile,
	  asf-debug.cpp: More fixes, bugs, etc.

2007-10-23  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h, asf.mdp, asf.cpp, asf-generated.h, asf-ffmpeg.cpp,
	  asf.h, asf-ffmpeg.h, Makefile: More fixes, changes, bugs, etc.
	* debug.cpp, debug.h: Some general object tracking.

2007-10-19  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h, asf.cpp, asf-ffmpeg.cpp, asf.h, asf-ffmpeg.h: Today's
	  work.

2007-10-18  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf-structures.h, asf-generated.cpp, asf.mdp, asf.cpp, asf.mds,
	  asf-ffmpeg.cpp, asf.h, asf-ffmpeg.h, asf-structures.cpp, asf.cs,
	  Makefile: Save current work.

2007-10-18  Rolf Bjarne Kvinge <RKvinge@novell.com> 

	* asf.h, asf-structures.h, asf-ffmpeg.h, asf.sh, asf-guids.cpp,
	  asf-generated.cpp, ChangeLog, asf-guids.h, asf.cpp, asf-generated.h,
	  asf-structures.cpp, asf-ffmpeg.cpp, asf.cs, Makefile: Backup current asf
	  code. Not really working at all yet.


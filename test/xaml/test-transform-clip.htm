<html>
  <head>
    <title>Moonlight Clip Modification Test</title>

      <script language="javascript">
	var control;
 
	function OnLoaded(sender, eventArgs)
        {
                if (document.body == null) {
                        setTimeout (function(){ OnLoaded(sender, eventArgs)}, 100);
                        return;
                }
	        
                setTimeout (function(){ RunTest(sender, eventArgs)}, 1000);
        }
	
        function RunTest (sender, eventArgs)
        {
	       var clip0 = sender.findName ("clipPoint0");
	       var clip1 = sender.findName ("clipPoint1");
	       var clip2 = sender.findName ("clipPoint2");
	       var clip3 = sender.findName ("clipPoint3");
	       var clip4 = sender.findName ("clipPoint4");

               clip0.Point = "0,0";
               clip1.Point = "200,0";
               clip2.Point = "200,200";
               clip3.Point = "0,200";
               clip4.Point = "0,0";

	       setTimeout ("Finish ()", 100);
        }

	function Finish ()
	{
	       var moonlight_control = document.getElementById ("MoonlightControl");
	       TakeSingleSnapshotAndShutdown (moonlight_control, "test-transform-clip.htm.png", 500, 500); 

	}

        function TakeSingleSnapshotAndShutdown (control, file_name, width, height, initial_delay)
        {
	         var test_plugin = document.getElementById ("_TestPlugin");
                 if (initial_delay) {
                         window.setTimeout (function () {
			         var test_plugin = document.getElementById ("_TestPlugin");
			         test_plugin.CaptureSingleImage ("", file_name, 0, 0, width, height);
				 test_plugin.SignalShutdown ();
		         }, initial_delay);
			 return;
	         }
                 test_plugin.CaptureSingleImage ("", file_name, 0, 0, width, height);
		 test_plugin.SignalShutdown ();
        }

        function TakeMultipleSnapshotsAndShutdown (control, max_images_to_capture, capture_interval, initial_delay, width, height)
	{
                 var test_plugin = document.getElementById ("_TestPlugin");

		 test_plugin.CaptureMultipleImages ("", "", 0, 0, width, height, max_images_to_capture, capture_interval, initial_delay);
		 test_plugin.SignalShutdown ();
	}

        function ErrorHandler (sender, args)
        {
	alert (args.ErrorMessage);
        }
      </script>
  </head>

  <body>
    <div>
        <embed type="application/x-silverlight"
             width="500"
             height="500"
             id="_MoonlightControl" Source="test-transform-clip.xaml" OnError="ErrorHandler" 
             style="position:absolute; left:0px; top:0px" >
        </embed>
    </div>
    <div>
        <embed id="_TestPlugin" width="0" height="0" type="application/x-jolttest">
        </embed>
    </div>
  </body>
</html>


